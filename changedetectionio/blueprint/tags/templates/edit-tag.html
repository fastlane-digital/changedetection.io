{% extends 'base.html' %}
{% block content %}
{% from '_helpers.html' import render_field, render_checkbox_field, render_button %}
{% from '_common_fields.html' import render_common_settings_form %}
<script>
    const notification_base_url="{{url_for('ui.ui_notification.ajax_callback_send_notification_test', mode="group-settings")}}";
</script>

<script src="{{url_for('static_content', group='js', filename='tabs.js')}}" defer></script>
<script>
/*{% if emailprefix %} const email_notification_prefix=JSON.parse('{{ emailprefix|tojson }}'); {% endif %}*/
{% set has_tag_filters_extra='' %}
</script>

<script src="{{url_for('static_content', group='js', filename='watch-settings.js')}}" defer></script>
<script src="{{url_for('static_content', group='js', filename='notifications.js')}}" defer></script>

<div class="max-w-3xl mx-auto p-4 sm:p-6 lg:p-8 monospaced-textarea">

    <div role="tablist" class="tabs tabs-lifted tabs-sm sm:tabs-md">
        <a role="tab" class="tab tab-active" href="#general">General</a>
        <a role="tab" class="tab" href="#filters-and-triggers">Filters &amp; Triggers</a>
        {% if extra_tab_content %}
        <a role="tab" class="tab" href="#extras_tab">{{ extra_tab_content }}</a>
        {% endif %}
        <a role="tab" class="tab" href="#notifications">Notifications</a>
    </div>

    <div class="bg-base-100 p-4 sm:p-6 rounded-box shadow-xl mt-0 border border-base-300 border-t-0">
        <form action="{{ url_for('tags.form_tag_edit', uuid=data.uuid) }}" method="POST" class="space-y-8">
             <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

            <div class="tab-pane-inner p-4 pt-6 space-y-6" id="general">
                {{ render_field(form.title, placeholder="Group Name", required=True, class="input input-bordered w-full") }}
            </div>

            <div class="tab-pane-inner p-4 pt-6 space-y-6" id="filters-and-triggers">
                <p class="text-sm text-base-content/70 mb-4">These settings are <strong><i>added</i></strong> to any existing watch configurations for watches in this group.</p>
                {% include "edit/include_subtract.html" %}
                <div class="text-filtering border border-base-300 p-4 rounded-lg my-4 space-y-4">
                    <h3 class="text-lg font-semibold">Text filtering</h3>
                    {% include "edit/text-options.html" %}
                </div>
            </div>

            {% if extra_form_content %}
            <div class="tab-pane-inner p-4 pt-6 space-y-6" id="extras_tab">
                {{ extra_form_content|safe }}
            </div>
            {% endif %}

            <div class="tab-pane-inner p-4 pt-6 space-y-6 relative" id="notifications"> {# Added relative for positioned button #}
                {{ render_checkbox_field(form.notification_muted) }}
                {{ render_checkbox_field(form.notification_screenshot, description_html='<strong>Use with caution!</strong> This will easily fill up your email storage quota or flood other storages.') }}
                
                <div class="field-group" id="notification-field-group">
                    {% if has_default_notification_urls %}
                    <div role="alert" class="alert alert-info text-sm mb-4">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-current shrink-0 w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        <span>There are <a href="{{ url_for('settings.settings_page')}}#notifications" class="link link-hover">system-wide notification URLs enabled</a>. Settings here will override global settings for watches in this group. An empty Notification URL list here will still use global system notifications.</span>
                    </div>
                    {% endif %}
                    <button type="button" id="notification-setting-reset-to-default" class="btn btn-accent btn-xs absolute top-4 right-4 normal-case">Use system defaults</button>
                    {{ render_common_settings_form(form, emailprefix, settings_application, extra_notification_token_placeholder_info) }}
                </div>
            </div>

            <div id="actions" class="flex flex-wrap gap-2 mt-8 pt-6 border-t border-base-300">
                {{ render_button(form.save_button, class="btn btn-primary") }}
                <a href="{{ url_for('tags.tags_overview_page') }}" class="btn btn-outline">Back to Groups</a>
            </div>
        </form>
    </div>
</div>
{% endblock %}
