{% extends 'base.html' %}
{% block content %}
{% from '_helpers.html' import render_simple_field, render_field, render_button %}
<script src="{{url_for('static_content', group='js', filename='jquery-3.6.0.min.js')}}"></script>

<div class="max-w-5xl mx-auto p-4 sm:p-6 lg:p-8">
    <form action="{{ url_for('tags.form_tag_add') }}" method="POST" id="new-tag-form" class="mb-8 p-4 bg-base-200 rounded-box shadow-lg">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" >
        <div class="space-y-3">
            <legend class="text-lg font-semibold mb-2">Add a new organisational group/tag</legend>
            <div id="tag-add-wrapper-zone" class="flex flex-col sm:flex-row items-stretch gap-2">
                <div class="flex-grow">
                    {{ render_simple_field(form.name, placeholder="Group label / tag name", class="input input-bordered input-sm sm:input-md w-full") }}
                </div>
                <div>
                    {{ render_button(form.save_button, text="Save Group", class="btn btn-primary btn-sm sm:btn-md") }}
                </div>
            </div>
            <p class="text-xs text-base-content/70 mt-1">Groups allows you to manage filters and notifications for multiple watches under a single organisational tag.</p>
        </div>
    </form>
    
    <div id="watch-table-wrapper" class="overflow-x-auto shadow-md rounded-lg">
        <table class="table table-zebra table-sm w-full">
            <thead class="bg-base-200">
            <tr>
                <th class="p-2 sm:p-3 w-12"></th> {# Mute Icon #}
                <th class="p-2 sm:p-3"># Watches</th>
                <th class="p-2 sm:p-3">Tag / Label name</th>
                <th class="p-2 sm:p-3 text-right">Actions</th>
            </tr>
            </thead>
            <tbody>
            {% if not available_tags|length %}
            <tr>
                <td colspan="4" class="p-4 text-center">No website organisational tags/groups configured.</td>
            </tr>
            {% endif %}
            {% for uuid, tag in available_tags  %}
            <tr id="{{ uuid }}">
                <td class="p-1 sm:p-2 watch-controls">
                     <form action="{{url_for('tags.mute', uuid=tag.uuid)}}" method="POST" class="inline">
                         <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                         <button type="submit" class="btn btn-ghost btn-xs p-1 link-mute state-{{'on' if tag.notification_muted else 'off'}}" title="{{'Unmute' if tag.notification_muted else 'Mute'}} notifications for this group">
                             <img src="{{url_for('static_content', group='images', filename='bell-off.svg')}}" alt="Mute/Unmute notifications" class="h-4 w-4 align-middle icon icon-mute">
                         </button>
                     </form>
                </td>
                <td class="p-2 sm:p-3">{{ "{:,}".format(tag_count[uuid]) if uuid in tag_count else 0 }}</td>
                <td class="p-2 sm:p-3 title-col"><a href="{{url_for('watchlist.index', tag=uuid) }}" class="link link-hover font-medium">{{ tag.title }}</a></td>
                <td class="p-1 sm:p-2 text-right whitespace-nowrap">
                    <a class="btn btn-xs btn-outline btn-primary normal-case" href="{{ url_for('tags.form_tag_edit', uuid=uuid) }}">Edit</a>
                    <a class="btn btn-xs btn-error btn-outline normal-case" href="{{ url_for('tags.delete', uuid=uuid) }}" title="Deletes and removes tag" onclick="return confirm('Are you sure you want to delete this group? This cannot be undone.');">Delete</a>
                    <a class="btn btn-xs btn-outline normal-case" href="{{ url_for('tags.unlink', uuid=uuid) }}" title="Keep the group but unlink any watches" onclick="return confirm('Are you sure you want to unlink all watches from this group?');">Unlink Watches</a>
                </td>
            </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}
