{% extends 'base.html' %}
{% block content %}
{% from '_helpers.html' import render_simple_field, render_field %}
<script src="{{url_for('static_content', group='js', filename='jquery-3.6.0.min.js')}}"></script>

<div class="box p-4 md:p-6">
    <form action="{{ url_for('tags.form_tag_add') }}" method="POST" id="new-tag-form" class="mb-6 p-4 border rounded-lg shadow-sm bg-base-100">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" >
        <fieldset class="space-y-4">
            <legend class="text-xl font-semibold mb-3">Add a new organisational group/tag</legend>
            <div id="tag-add-wrapper-zone" class="flex flex-wrap items-end gap-3">
                <div class="form-control flex-grow">
                    {{ render_simple_field(form.name, placeholder="Group/Tag name", class="input input-bordered w-full", label_class="label-text") }}
                </div>
                <div class="form-control">
                    {{ render_simple_field(form.save_button, title="Save", class="btn btn-primary") }}
                </div>
            </div>
            <p class="text-xs text-base-content text-opacity-70 mt-2">Groups allows you to manage filters and notifications for multiple watches under a single organisational tag.</p>
        </fieldset>
    </form>

    <div id="watch-table-wrapper" class="overflow-x-auto shadow-md rounded-lg">
        <table class="table table-zebra w-full">
            <thead>
                <tr>
                    <th class="w-12">Mute</th>
                    <th># Watches</th>
                    <th>Tag / Label name</th>
                    <th class="text-right">Actions</th>
                </tr>
            </thead>
            <tbody>
            {% if not available_tags|length %}
                <tr>
                    <td colspan="4" class="text-center p-4">No website organisational tags/groups configured.</td>
                </tr>
            {% endif %}
            {% for uuid, tag_item in available_tags  %} {# Renamed tag to tag_item #}
            <tr id="{{ uuid }}">
                <td class="watch-controls">
                    <a class="btn btn-ghost btn-xs p-1" href="{{url_for('tags.mute', uuid=tag_item.uuid)}}" title="{{'Unmute' if tag_item.notification_muted else 'Mute'}} notifications">
                        <img src="{{url_for('static_content', group='images', filename='bell-off.svg')}}" alt="Mute/Unmute" class="h-4 w-4 {{ '' if tag_item.notification_muted else 'opacity-30' }}" >
                    </a>
                </td>
                <td>{{ "{:,}".format(tag_count[uuid]) if uuid in tag_count else 0 }}</td>
                <td class="title-col"> <a href="{{url_for('watchlist.index', tag=uuid) }}" class="link link-hover">{{ tag_item.title }}</a></td>
                <td class="text-right space-x-1">
                    <a class="btn btn-sm btn-outline" href="{{ url_for('tags.form_tag_edit', uuid=uuid) }}">Edit</a>
                    <a class="btn btn-sm btn-error btn-outline" href="{{ url_for('tags.delete', uuid=uuid) }}" title="Deletes and removes tag">Delete</a>
                    <a class="btn btn-sm btn-warning btn-outline" href="{{ url_for('tags.unlink', uuid=uuid) }}" title="Keep the tag but unlink any watches">Unlink</a>
                </td>
            </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}
