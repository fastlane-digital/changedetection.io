{% extends 'base.html' %}
{% block content %}
{% from '_helpers.html' import render_field, render_button %}
<script src="{{url_for('static_content', group='js', filename='tabs.js')}}" defer></script>

<div class="max-w-2xl mx-auto p-4 sm:p-6 lg:p-8">
    <div role="tablist" class="tabs tabs-lifted tabs-sm sm:tabs-md">
        <a role="tab" class="tab tab-active" href="#url-list">URL List</a>
        <a role="tab" class="tab" href="#distill-io">Distill.io</a>
        <a role="tab" class="tab" href="#xlsx">.XLSX &amp; Wachete</a>
    </div>

    <div class="bg-base-100 p-4 sm:p-6 rounded-box shadow-xl mt-0 border border-base-300 border-t-0">
        <form action="{{url_for('imports.import_page')}}" method="POST" enctype="multipart/form-data" class="space-y-8">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

            <div class="tab-pane-inner p-4 pt-6 space-y-6" id="url-list">
                <div class="text-sm text-base-content/80 mb-4">
                    <p>Enter one URL per line, and optionally add tags for each URL after a space, delineated by comma (,):</p>
                    <p class="mt-1"><strong>Example:</strong> <kbd class="kbd kbd-sm">https://example.com tag1, tag2, last tag</kbd></p>
                    <p class="mt-1">URLs which do not pass validation will stay in the textarea.</p>
                </div>
                
                {# Assuming form.processor is a RadioField or SelectField, render_field should handle it. #}
                {{ render_field(form.processor, div_class="processor-field-wrapper") }}
                
                <div>
                    <label class="label" for="urls-textarea"><span class="label-text">URLs to import:</span></label>
                    <textarea id="urls-textarea" name="urls" class="textarea textarea-bordered leading-normal w-full h-60 font-mono text-sm" placeholder="https://...">{{ import_url_list_remaining }}</textarea>
                 </div>
                 <div id="quick-watch-processor-type"></div>
            </div>

            <div class="tab-pane-inner p-4 pt-6 space-y-6" id="distill-io">
                <div class="text-sm text-base-content/80 mb-4 space-y-1">
                    <p>Copy and Paste your Distill.io watch 'export' file, this should be a JSON file.</p>
                    <p>This is <i>experimental</i>, supported fields are <code>name</code>, <code>uri</code>, <code>tags</code>, <code>config:selections</code>, the rest (including <code>schedule</code>) are ignored.</p>
                    <p>How to export? <a href="https://distill.io/docs/web-monitor/how-export-and-import-monitors/" class="link link-hover" target="_blank" rel="noopener">https://distill.io/docs/web-monitor/how-export-and-import-monitors/</a></p>
                    <p>Be sure to set your default fetcher to Chrome if required.</p>
                </div>
                <div>
                    <label class="label" for="distill-io-textarea"><span class="label-text">Distill.io JSON:</span></label>
                    <textarea id="distill-io-textarea" name="distill-io" class="textarea textarea-bordered leading-normal w-full h-60 font-mono text-sm" placeholder="Example Distill.io JSON export file...">{Pasted JSON example ommitted for brevity...}{{ original_distill_json }}</textarea>
                </div>
            </div>

            <div class="tab-pane-inner p-4 pt-6 space-y-6" id="xlsx">
                {{ render_field(form.xlsx_file, class="file-input file-input-bordered file-input-primary w-full max-w-md") }}
                {{ render_field(form.file_mapping, class="select select-bordered w-full max-w-md") }}
                
                <div class="form-control w-full">
                    <label class="label"><span class="label-text-alt">Table of custom column and data types mapping for the <strong>Custom mapping</strong> File mapping type.</span></label>
                    <div class="overflow-x-auto">
                        <table class="table table-compact w-full my-2 text-sm border border-base-300 rounded-lg">
                            <thead class="bg-base-200">
                                <tr>
                                    <th class="p-2">Column #</th>
                                    {% for n in range(4) %}
                                        <td class="p-2"><input type="number" name="custom_xlsx[col_{{n}}]" class="input input-bordered input-xs w-20" min="1"></td>
                                    {%  endfor %}
                                </tr>
                                <tr>
                                    <th class="p-2">Type</th>
                                    {% for n in range(4) %}
                                        <td class="p-2">
                                            <select name="custom_xlsx[col_type_{{n}}]" class="select select-bordered select-xs w-full max-w-[120px]">
                                                <option value="">-- none --</option>
                                                <option value="url">URL</option>
                                                <option value="title">Title</option>
                                                <option value="include_filters">CSS/xPath filter</option>
                                                <option value="tag">Group / Tag name(s)</option>
                                                <option value="interval_minutes">Recheck time (minutes)</option>
                                            </select>
                                        </td>
                                    {%  endfor %}
                                </tr>
                            </thead>
                        </table>
                    </div>
                </div>
            </div>
            <div class="pt-4"> <!-- Added padding top for separation -->
                {{ render_button(form.submit, text="Import", class="btn btn-primary w-full sm:w-auto") }}
            </div>
        </form>
    </div>
</div>
{% endblock %}